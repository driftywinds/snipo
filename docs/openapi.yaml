openapi: 3.1.0
info:
  title: Snipo API
  description: |
    REST API for Snipo - a lightweight, self-hosted snippet manager.
    
    ## Authentication
    
    All protected endpoints require authentication via one of:
    - **Session Cookie**: `snipo_session` cookie (for web UI)
    - **Bearer Token**: `Authorization: Bearer <token>` header
    - **API Key**: `X-API-Key: <key>` header
    
    API tokens can be created via the Settings page or `/api/v1/tokens` endpoint.
    
    ### Token Permissions
    
    API tokens have permission levels that control access:
    - **read**: Can only access GET endpoints (view snippets, tags, folders)
    - **write**: Can create, update, and delete snippets, tags, and folders
    - **admin**: Full access including token management, settings, and backups
    
    Session-based auth (web UI) has full admin access by default.
    
    ## Rate Limiting
    
    API endpoints are rate-limited based on permission level:
    - **Read operations**: 1000 requests/hour (configurable via `SNIPO_RATE_LIMIT_READ`)
    - **Write operations**: 500 requests/hour (configurable via `SNIPO_RATE_LIMIT_WRITE`)
    - **Admin operations**: 100 requests/hour (configurable via `SNIPO_RATE_LIMIT_ADMIN`)
    
    Rate limit information is included in response headers:
    - `X-RateLimit-Limit`: Maximum requests per window
    - `X-RateLimit-Remaining`: Requests remaining in current window
    - `X-RateLimit-Reset`: Unix timestamp when the limit resets
    - `Retry-After`: Seconds to wait before retrying (when limit exceeded)
    
    ## Response Format
    
    All API responses use a standardized envelope format:
    
    **Single Resource:**
    ```json
    {
      "data": {...},
      "meta": {
        "request_id": "uuid",
        "timestamp": "2024-12-24T10:30:00Z",
        "version": "1.0"
      }
    }
    ```
    
    **List with Pagination:**
    ```json
    {
      "data": [...],
      "pagination": {
        "page": 1,
        "limit": 20,
        "total": 150,
        "total_pages": 8,
        "links": {
          "self": "/api/v1/snippets?page=1&limit=20",
          "next": "/api/v1/snippets?page=2&limit=20",
          "prev": null
        }
      },
      "meta": {
        "request_id": "uuid",
        "timestamp": "2024-12-24T10:30:00Z",
        "version": "1.0"
      }
    }
    ```
    
    ## Request Tracking
    
    Every request is assigned a unique `request_id` (UUID v4) for tracking and debugging.
    The ID is returned in:
    - Response header: `X-Request-ID`
    - Response body: `meta.request_id`
    
    ## Configuration
    
    The API supports configuration via environment variables:
    - `SNIPO_ALLOWED_ORIGINS`: CORS allowed origins (comma-separated)
    - `SNIPO_RATE_LIMIT_READ/WRITE/ADMIN`: Custom rate limits
    - `SNIPO_ENABLE_PUBLIC_SNIPPETS`: Enable/disable public snippet sharing
    - `SNIPO_ENABLE_API_TOKENS`: Enable/disable API token creation
    - `SNIPO_ENABLE_BACKUP_RESTORE`: Enable/disable backup/restore features
    
    Feature flags are exposed via `/health` endpoint.
  version: 1.0.0
  license:
    name: GPL-3.0
    url: https://www.gnu.org/licenses/gpl-3.0.html
  contact:
    name: Mohamed Elashri 
    url: https://github.com/MohamedElashri/snipo

servers:
  - url: http://localhost:8080
    description: Local development server

tags:
  - name: Health
    description: Health check endpoints
  - name: Authentication
    description: Login, logout, and session management
  - name: Snippets
    description: Code snippet CRUD operations
  - name: Tags
    description: Tag management
  - name: Folders
    description: Folder organization
  - name: Tokens
    description: API token management
  - name: Backup
    description: Backup and restore operations
  - name: Settings
    description: Application settings management (admin only)
  - name: Documentation
    description: API documentation and specifications

paths:
  /ping:
    get:
      tags: [Health]
      summary: Liveness check
      description: Simple liveness check that returns "pong"
      operationId: ping
      responses:
        '200':
          description: Service is alive
          content:
            text/plain:
              schema:
                type: string
                examples:
                  - pong

  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Returns health status including database connectivity and version info
      operationId: health
      responses:
        '200':
          description: Health status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /api/v1/auth/login:
    post:
      tags: [Authentication]
      summary: Login
      description: Authenticate with password and receive a session cookie
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          headers:
            Set-Cookie:
              schema:
                type: string
                examples:
                  - snipo_session=abc123; Path=/; HttpOnly; SameSite=Lax
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'

  /api/v1/auth/logout:
    post:
      tags: [Authentication]
      summary: Logout
      description: Invalidate current session
      operationId: logout
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'

  /api/v1/auth/check:
    get:
      tags: [Authentication]
      summary: Check authentication status
      description: Verify if current session is valid
      operationId: authCheck
      responses:
        '200':
          description: Authenticated
          content:
            application/json:
              schema:
                type: object
                properties:
                  authenticated:
                    type: boolean
                    examples:
                      - true
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/auth/change-password:
    post:
      tags: [Authentication]
      summary: Change password
      description: Update the application password
      operationId: changePassword
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    examples:
                      - true
                  message:
                    type: string
                    examples:
                      - Password changed successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/snippets:
    get:
      tags: [Snippets]
      summary: List snippets
      description: Get paginated list of snippets with optional filtering
      operationId: listSnippets
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: q
          in: query
          description: |
            Search query (fuzzy search). Searches across snippet titles, descriptions, 
            content, file contents, and filenames. Multiple words are matched with AND logic.
          schema:
            type: string
          example: "python docker"
        - name: language
          in: query
          description: Filter by programming language
          schema:
            type: string
          example: "javascript"
        - name: favorite
          in: query
          description: Filter by favorite status
          schema:
            type: boolean
        - name: tag_id
          in: query
          description: Filter by single tag ID (deprecated, use tag_ids for multiple)
          schema:
            type: integer
          example: 1
        - name: tag_ids
          in: query
          description: Filter by multiple tag IDs (comma-separated)
          schema:
            type: string
          example: "1,2,3"
        - name: folder_id
          in: query
          description: Filter by single folder ID (deprecated, use folder_ids for multiple)
          schema:
            type: integer
          example: 1
        - name: folder_ids
          in: query
          description: Filter by multiple folder IDs (comma-separated)
          schema:
            type: string
          example: "1,2"
        - name: is_archived
          in: query
          description: Filter by archived status (default is false)
          schema:
            type: boolean
          example: false
        - name: sort
          in: query
          description: Sort field
          schema:
            type: string
            enum: [created_at, updated_at, title]
            default: updated_at
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: List of snippets with pagination
          headers:
            X-Request-ID:
              description: Unique request identifier
              schema:
                type: string
                format: uuid
            X-API-Version:
              description: API version
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SnippetListResponse'
              examples:
                paginated_list:
                  summary: Paginated list of snippets
                  value:
                    data:
                      - id: 1
                        title: "HTTP Server in Go"
                        language: "go"
                        is_public: false
                        is_archived: false
                        folder_id: 2
                        tags: ["golang", "http", "server"]
                        created_at: "2024-12-20T10:00:00Z"
                        updated_at: "2024-12-20T10:00:00Z"
                      - id: 2
                        title: "Database Query Helper"
                        language: "python"
                        is_public: true
                        is_archived: false
                        folder_id: 2
                        tags: ["python", "database"]
                        created_at: "2024-12-21T14:30:00Z"
                        updated_at: "2024-12-21T14:30:00Z"
                    pagination:
                      page: 1
                      limit: 20
                      total: 45
                      total_pages: 3
                      links:
                        self: "/api/v1/snippets?page=1&limit=20"
                        next: "/api/v1/snippets?page=2&limit=20"
                        prev: null
                    meta:
                      request_id: "550e8400-e29b-41d4-a716-446655440000"
                      timestamp: "2024-12-24T10:30:00Z"
                      version: "1.0"
                filtered_by_tag:
                  summary: Filtered by tag
                  value:
                    data:
                      - id: 1
                        title: "HTTP Server in Go"
                        language: "go"
                        is_public: false
                        is_archived: false
                        tags: ["golang", "http", "server"]
                        created_at: "2024-12-20T10:00:00Z"
                        updated_at: "2024-12-20T10:00:00Z"
                    pagination:
                      page: 1
                      limit: 20
                      total: 1
                      total_pages: 1
                      links:
                        self: "/api/v1/snippets?tag=golang&page=1&limit=20"
                        next: null
                        prev: null
                    meta:
                      request_id: "550e8400-e29b-41d4-a716-446655440001"
                      timestamp: "2024-12-24T10:31:00Z"
                      version: "1.0"
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags: [Snippets]
      summary: Create snippet
      description: Create a new code snippet
      operationId: createSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SnippetInput'
            examples:
              basic:
                summary: Basic snippet
                value:
                  title: "Hello World"
                  content: |
                    package main
                    
                    import "fmt"
                    
                    func main() {
                        fmt.Println("Hello, World!")
                    }
                  language: "go"
                  description: "Simple Go hello world program"
              with_tags_and_folder:
                summary: Snippet with tags and folder
                value:
                  title: "Database Connection Pool"
                  content: |
                    import psycopg2.pool
                    
                    pool = psycopg2.pool.SimpleConnectionPool(
                        minconn=1,
                        maxconn=20,
                        host='localhost',
                        database='mydb',
                        user='user',
                        password='pass'
                    )
                  language: "python"
                  description: "PostgreSQL connection pool setup"
                  tags: ["database", "postgresql", "python"]
                  folder_id: 5
                  is_public: false
      responses:
        '201':
          description: Snippet created successfully
          headers:
            X-Request-ID:
              description: Unique request identifier
              schema:
                type: string
                format: uuid
            X-API-Version:
              description: API version
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResponse'
              examples:
                success:
                  summary: Successful creation
                  value:
                    data:
                      id: 42
                      title: "Hello World"
                      content: |
                        package main
                        
                        import "fmt"
                        
                        func main() {
                            fmt.Println("Hello, World!")
                        }
                      language: "go"
                      description: "Simple Go hello world program"
                      is_public: false
                      is_archived: false
                      folder_id: null
                      tags: []
                      created_at: "2024-12-24T10:30:00Z"
                      updated_at: "2024-12-24T10:30:00Z"
                    meta:
                      request_id: "550e8400-e29b-41d4-a716-446655440000"
                      timestamp: "2024-12-24T10:30:00Z"
                      version: "1.0"
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_request:
                  value:
                    error:
                      code: "INVALID_REQUEST"
                      message: "Request body is required"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                empty_title:
                  summary: Empty title validation error
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "title"
                          message: "Title must not be empty"
                multiple_errors:
                  summary: Multiple validation errors
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "title"
                          message: "Title must not be empty"
                        - field: "language"
                          message: "Unsupported language: 'invalid_lang'"
                        - field: "folder_id"
                          message: "Folder with ID 999 not found"

  /api/v1/snippets/search:
    get:
      tags: [Snippets]
      summary: Full-text search
      description: Search snippets using full-text search
      operationId: searchSnippets
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: q
          in: query
          required: true
          description: Search query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Snippet'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/snippets/public/{id}:
    get:
      tags: [Snippets]
      summary: Get public snippet
      description: Get a public snippet without authentication
      operationId: getPublicSnippet
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Public snippet
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snippet'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/snippets/{id}:
    get:
      tags: [Snippets]
      summary: Get snippet
      description: Get a single snippet by ID
      operationId: getSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Snippet details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snippet'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Snippets]
      summary: Update snippet
      description: Update an existing snippet
      operationId: updateSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SnippetInput'
      responses:
        '200':
          description: Snippet updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snippet'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

    delete:
      tags: [Snippets]
      summary: Delete snippet
      description: Delete a snippet
      operationId: deleteSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Snippet deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/snippets/{id}/favorite:
    post:
      tags: [Snippets]
      summary: Toggle favorite
      description: Toggle the favorite status of a snippet
      operationId: toggleFavorite
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Favorite toggled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snippet'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/snippets/{id}/duplicate:
    post:
      tags: [Snippets]
      summary: Duplicate snippet
      description: Create a copy of an existing snippet
      operationId: duplicateSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '201':
          description: Snippet duplicated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snippet'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/snippets/{id}/archive:
    post:
      tags: [Snippets]
      summary: Archive snippet
      description: |
        Archive a snippet (hide from main list).
        Requires write or admin permission.
      operationId: archiveSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Snippet ID
      responses:
        '200':
          description: Snippet archived successfully
          headers:
            X-Request-ID:
              schema:
                type: string
                format: uuid
              description: Unique request identifier
            X-API-Version:
              schema:
                type: string
              description: API version
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Snippet'
                  meta:
                    $ref: '#/components/schemas/Meta'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/snippets/{id}/history:
    get:
      tags: [Snippets]
      summary: Get snippet history
      description: |
        Retrieve version history for a snippet.
        Requires read, write, or admin permission.
      operationId: getSnippetHistory
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Snippet ID
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
          description: Maximum number of history entries to return
      responses:
        '200':
          description: Snippet history retrieved successfully
          headers:
            X-Request-ID:
              schema:
                type: string
                format: uuid
            X-API-Version:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/HistoryEntry'
                  meta:
                    $ref: '#/components/schemas/Meta'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/snippets/{id}/history/{history_id}/restore:
    post:
      tags: [Snippets]
      summary: Restore from history
      description: |
        Restore a snippet to a previous version from history.
        Requires write or admin permission.
      operationId: restoreSnippetHistory
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Snippet ID
        - name: history_id
          in: path
          required: true
          schema:
            type: string
          description: History entry ID to restore from
      responses:
        '200':
          description: Snippet restored successfully
          headers:
            X-Request-ID:
              schema:
                type: string
                format: uuid
            X-API-Version:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Snippet'
                  meta:
                    $ref: '#/components/schemas/Meta'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/tags:
    get:
      tags: [Tags]
      summary: List tags
      description: Get all tags with snippet counts
      operationId: listTags
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      responses:
        '200':
          description: List of tags
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Tag'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags: [Tags]
      summary: Create tag
      description: Create a new tag
      operationId: createTag
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TagInput'
      responses:
        '201':
          description: Tag created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Tag already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/tags/{id}:
    get:
      tags: [Tags]
      summary: Get tag
      description: Get a single tag by ID
      operationId: getTag
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Tag details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Tags]
      summary: Update tag
      description: Update an existing tag
      operationId: updateTag
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TagInput'
      responses:
        '200':
          description: Tag updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Tag name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags: [Tags]
      summary: Delete tag
      description: Delete a tag
      operationId: deleteTag
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Tag deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/folders:
    get:
      tags: [Folders]
      summary: List folders
      description: Get all folders, optionally as a tree structure
      operationId: listFolders
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: tree
          in: query
          description: Return as nested tree structure
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: List of folders
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Folder'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags: [Folders]
      summary: Create folder
      description: Create a new folder
      operationId: createFolder
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FolderInput'
      responses:
        '201':
          description: Folder created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/folders/{id}:
    get:
      tags: [Folders]
      summary: Get folder
      description: Get a single folder by ID
      operationId: getFolder
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Folder details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Folders]
      summary: Update folder
      description: Update an existing folder
      operationId: updateFolder
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FolderInput'
      responses:
        '200':
          description: Folder updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

    delete:
      tags: [Folders]
      summary: Delete folder
      description: Delete a folder (cascades to child folders)
      operationId: deleteFolder
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Folder deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/folders/{id}/move:
    put:
      tags: [Folders]
      summary: Move folder
      description: Move a folder to a new parent
      operationId: moveFolder
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                parent_id:
                  type: [integer, "null"]
                  description: New parent folder ID (null for root)
      responses:
        '200':
          description: Folder moved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/tokens:
    get:
      tags: [Tokens]
      summary: List API tokens
      description: Get all API tokens (without the actual token values)
      operationId: listTokens
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      responses:
        '200':
          description: List of tokens
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/APIToken'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags: [Tokens]
      summary: Create API token
      description: Create a new API token. The token value is only returned once.
      operationId: createToken
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/APITokenInput'
      responses:
        '201':
          description: Token created (includes the token value)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIToken'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/tokens/{id}:
    get:
      tags: [Tokens]
      summary: Get token info
      description: Get token metadata (not the token value)
      operationId: getToken
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Token info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIToken'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Tokens]
      summary: Revoke token
      description: Revoke an API token
      operationId: deleteToken
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Token revoked
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/backup/export:
    get:
      tags: [Backup]
      summary: Export backup
      description: Export all data as JSON or ZIP, optionally encrypted
      operationId: exportBackup
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: format
          in: query
          description: Export format
          schema:
            type: string
            enum: [json, zip]
            default: json
        - name: password
          in: query
          description: Optional encryption password
          schema:
            type: string
      responses:
        '200':
          description: Backup file
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackupData'
            application/zip:
              schema:
                type: string
                format: binary
            application/octet-stream:
              schema:
                type: string
                format: binary
                description: Encrypted backup
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/backup/import:
    post:
      tags: [Backup]
      summary: Import backup
      description: Import data from a backup file
      operationId: importBackup
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: Backup file (JSON or ZIP)
                strategy:
                  type: string
                  enum: [replace, merge, skip]
                  default: merge
                  description: |
                    - replace: Clear all data and import
                    - merge: Add new items, keep existing
                    - skip: Only add items that don't exist
                password:
                  type: string
                  description: Decryption password if backup is encrypted
      responses:
        '200':
          description: Import result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/backup/s3/status:
    get:
      tags: [Backup]
      summary: S3 status
      description: Check if S3 storage is configured
      operationId: s3Status
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      responses:
        '200':
          description: S3 configuration status
          content:
            application/json:
              schema:
                type: object
                properties:
                  enabled:
                    type: boolean
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/backup/s3/sync:
    post:
      tags: [Backup]
      summary: Sync to S3
      description: Upload a backup to S3 storage
      operationId: s3Sync
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExportOptions'
      responses:
        '200':
          description: Sync result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/S3SyncResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '503':
          description: S3 not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/backup/s3/list:
    get:
      tags: [Backup]
      summary: List S3 backups
      description: List all backups stored in S3
      operationId: s3List
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      responses:
        '200':
          description: List of S3 backups
          content:
            application/json:
              schema:
                type: object
                properties:
                  backups:
                    type: array
                    items:
                      $ref: '#/components/schemas/S3BackupInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '503':
          description: S3 not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/backup/s3/restore:
    post:
      tags: [Backup]
      summary: Restore from S3
      description: Restore data from an S3 backup
      operationId: s3Restore
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [key]
              properties:
                key:
                  type: string
                  description: S3 object key
                strategy:
                  type: string
                  enum: [replace, merge, skip]
                  default: merge
                password:
                  type: string
                  description: Decryption password if backup is encrypted
      responses:
        '200':
          description: Restore result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '503':
          description: S3 not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/backup/s3/delete:
    delete:
      tags: [Backup]
      summary: Delete S3 backup
      description: Delete a backup from S3 storage
      operationId: s3Delete
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: key
          in: query
          required: true
          description: S3 object key to delete
          schema:
            type: string
      responses:
        '200':
          description: Backup deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Backup deleted successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '503':
          description: S3 not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/settings:
    get:
      tags: [Settings]
      summary: Get settings
      description: |
        Get application settings including theme, editor preferences, and S3 configuration.
        Requires admin permission.
      operationId: getSettings
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      responses:
        '200':
          description: Settings retrieved successfully
          headers:
            X-Request-ID:
              schema:
                type: string
                format: uuid
            X-API-Version:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Settings'
                  meta:
                    $ref: '#/components/schemas/Meta'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

    put:
      tags: [Settings]
      summary: Update settings
      description: |
        Update application settings.
        Requires admin permission.
        All fields are validated.
      operationId: updateSettings
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SettingsInput'
            examples:
              theme_update:
                summary: Update theme settings
                value:
                  theme: "dark"
                  editor_theme: "monokai"
              font_update:
                summary: Update font sizes
                value:
                  font_size: 14
                  tab_size: 2
                  markdown_font_size: 16
              feature_toggle:
                summary: Enable/disable features
                value:
                  archive_enabled: true
                  history_enabled: true
              full_update:
                summary: Update multiple settings
                value:
                  theme: "dark"
                  editor_theme: "tomorrow_night"
                  font_size: 16
                  tab_size: 4
                  markdown_font_size: 18
                  archive_enabled: true
                  history_enabled: true
      responses:
        '200':
          description: Settings updated successfully
          headers:
            X-Request-ID:
              schema:
                type: string
                format: uuid
              description: Unique request identifier
            X-API-Version:
              schema:
                type: string
              description: API version
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Settings'
                  meta:
                    $ref: '#/components/schemas/Meta'
              examples:
                success:
                  summary: Successful settings update
                  value:
                    data:
                      id: 1
                      theme: "dark"
                      editor_theme: "tomorrow_night"
                      font_size: 16
                      tab_size: 4
                      markdown_font_size: 18
                      archive_enabled: true
                      history_enabled: true
                      created_at: "2024-01-01T00:00:00Z"
                      updated_at: "2024-12-24T10:35:00Z"
                    meta:
                      request_id: "550e8400-e29b-41d4-a716-446655440005"
                      timestamp: "2024-12-24T10:35:00Z"
                      version: "1.0"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                invalid_theme:
                  summary: Invalid theme value
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "theme"
                          message: "Theme must be 'light' or 'dark'"
                invalid_font_size:
                  summary: Font size out of range
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "font_size"
                          message: "Font size must be between 8 and 32"
                invalid_editor_theme:
                  summary: Unsupported editor theme
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "editor_theme"
                          message: "Unsupported editor theme: 'invalid_theme'"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                admin_required:
                  value:
                    error:
                      code: "ADMIN_REQUIRED"
                      message: "This operation requires admin-level permissions"

  /api/v1/openapi.json:
    get:
      tags: [Documentation]
      summary: Get OpenAPI specification
      description: |
        Returns the OpenAPI 3.1 specification for this API.
        This endpoint is publicly accessible (no authentication required).
      operationId: getOpenAPISpec
      responses:
        '200':
          description: OpenAPI specification
          content:
            application/yaml:
              schema:
                type: object
                description: OpenAPI 3.1 specification

components:
  securitySchemes:
    sessionCookie:
      type: apiKey
      in: cookie
      name: snipo_session
      description: |
        Session-based authentication for web UI.
        Full admin access (equivalent to admin permission level).
    bearerAuth:
      type: http
      scheme: bearer
      description: |
        API token authentication using Bearer token.
        Permission level depends on token configuration:
        - **read**: GET endpoints only
        - **write**: GET, POST, PUT, DELETE for snippets, tags, folders
        - **admin**: Full access including tokens, settings, backups
    apiKey:
      type: apiKey
      in: header
      name: X-API-Key
      description: |
        API key authentication (alternative to Bearer token).
        Permission level depends on token configuration (read/write/admin).

  schemas:
    Error:
      type: object
      description: |
        Standard error response format. All errors include a code and message.
        
        **Common Error Codes:**
        
        **Authentication Errors (401):**
        - `UNAUTHORIZED`: Missing or invalid authentication credentials
        - `INVALID_TOKEN`: API token is invalid or expired
        - `SESSION_EXPIRED`: Session has expired, login required
        
        **Authorization Errors (403):**
        - `FORBIDDEN`: Insufficient permissions for this operation
        - `READ_ONLY_TOKEN`: Token has read-only permissions, write access required
        - `ADMIN_REQUIRED`: Operation requires admin-level permissions
        
        **Resource Errors (404):**
        - `NOT_FOUND`: Requested resource does not exist
        - `SNIPPET_NOT_FOUND`: Snippet with specified ID not found
        - `FOLDER_NOT_FOUND`: Folder with specified ID not found
        - `TAG_NOT_FOUND`: Tag with specified ID not found
        - `TOKEN_NOT_FOUND`: API token with specified ID not found
        - `HISTORY_NOT_FOUND`: History version not found
        
        **Rate Limiting (429):**
        - `RATE_LIMIT_EXCEEDED`: Too many requests, please slow down
          - Response includes `Retry-After` header with seconds to wait
          - Default limits: 100 req/min (authenticated), 20 req/min (public)
        
        **Server Errors (500):**
        - `INTERNAL_ERROR`: Unexpected server error occurred
        - `DATABASE_ERROR`: Database operation failed
        - `S3_ERROR`: S3 storage operation failed
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Machine-readable error code (see description for full list)
              examples:
                - "UNAUTHORIZED"
            message:
              type: string
              description: Human-readable error message
              examples:
                - "Authentication required"
      examples:
        - error:
            code: "FORBIDDEN"
            message: "Insufficient permissions to perform this action"

    ValidationError:
      type: object
      description: |
        Validation error response with detailed field-level errors.
        Returned when request data fails validation rules.
        
        **Validation Error Codes:**
        - `VALIDATION_ERROR`: Generic validation failure
        - `INVALID_TITLE`: Title validation failed (empty, too long, invalid format)
        - `INVALID_LANGUAGE`: Unsupported programming language specified
        - `INVALID_THEME`: Invalid theme value (must be 'light' or 'dark')
        - `INVALID_FONT_SIZE`: Font size out of range (8-32)
        - `INVALID_TAB_SIZE`: Tab size out of range (1-8)
        - `INVALID_EDITOR_THEME`: Unsupported editor theme specified
        - `INVALID_PAGE`: Page number must be >= 1
        - `INVALID_LIMIT`: Limit must be between 1 and 100
        - `INVALID_SORT`: Invalid sort field or direction
        - `INVALID_FILTER`: Invalid filter parameter or combination
        - `DUPLICATE_NAME`: Resource with this name already exists
        
        **Field-Level Validation Rules:**
        
        *Snippet Fields:*
        - `title`: Required, 1-500 characters, no leading/trailing whitespace
        - `content`: Optional, max 1MB
        - `language`: Optional, must be supported language
        - `description`: Optional, max 5000 characters
        - `folder_id`: Optional, must exist if provided
        - `tags`: Optional array, each tag 1-50 characters
        
        *Settings Fields:*
        - `theme`: Must be 'light' or 'dark'
        - `editor_theme`: Must be supported Ace editor theme
        - `font_size`: Integer between 8 and 32
        - `tab_size`: Integer between 1 and 8
        - `markdown_font_size`: Integer between 8 and 32
        
        *Tag/Folder Fields:*
        - `name`: Required, 1-100 characters, unique within scope
        - `description`: Optional, max 500 characters
        
        *Token Fields:*
        - `name`: Required, 1-100 characters
        - `permission`: Must be 'read', 'write', or 'admin'
        - `expires_at`: Optional, must be future date
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Error code (typically VALIDATION_ERROR)
              examples:
                - "VALIDATION_ERROR"
            message:
              type: string
              description: Human-readable error summary
              examples:
                - "Validation failed"
            details:
              type: array
              description: Array of field-specific validation errors
              items:
                type: object
                properties:
                  field:
                    type: string
                    description: Name of the field that failed validation
                    examples:
                      - "title"
                  message:
                    type: string
                    description: Specific validation error for this field
                    examples:
                      - "Title must not be empty"
      examples:
        - error:
            code: "VALIDATION_ERROR"
            message: "Validation failed"
            details:
              - field: "title"
                message: "Title must not be empty"
              - field: "font_size"
                message: "Font size must be between 8 and 32"

    # Standard Response Envelope
    Meta:
      type: object
      description: Metadata included in all API responses
      properties:
        request_id:
          type: string
          format: uuid
          description: Unique request identifier for tracking and debugging
          examples:
            - "550e8400-e29b-41d4-a716-446655440000"
        timestamp:
          type: string
          format: date-time
          description: UTC timestamp of the response
          examples:
            - "2024-12-24T10:30:00Z"
        version:
          type: string
          description: API version
          examples:
            - "1.0"

    PaginationLinks:
      type: object
      description: Navigation links for paginated responses
      properties:
        self:
          type: string
          description: Link to current page
          examples:
            - "/api/v1/snippets?page=1&limit=20"
        next:
          type: [string, "null"]
          description: Link to next page (null if on last page)
          examples:
            - "/api/v1/snippets?page=2&limit=20"
        prev:
          type: [string, "null"]
          description: Link to previous page (null if on first page)
          examples:
            - null

    Pagination:
      type: object
      description: Pagination metadata for list responses
      properties:
        page:
          type: integer
          description: Current page number (1-indexed)
          examples:
            - 1
        limit:
          type: integer
          description: Number of items per page
          examples:
            - 20
        total:
          type: integer
          description: Total number of items
          examples:
            - 150
        total_pages:
          type: integer
          description: Total number of pages
          examples:
            - 8
        links:
          $ref: '#/components/schemas/PaginationLinks'

    APIResponse:
      type: object
      description: Standard envelope for single resource responses
      properties:
        data:
          type: object
          description: The response payload
        meta:
          $ref: '#/components/schemas/Meta'

    ListResponse:
      type: object
      description: Standard envelope for list responses with pagination
      properties:
        data:
          type: array
          items: {}
          description: Array of items
        pagination:
          $ref: '#/components/schemas/Pagination'
        meta:
          $ref: '#/components/schemas/Meta'

    # Feature Flags
    FeatureFlags:
      type: object
      description: Enabled features in the API
      properties:
        public_snippets:
          type: boolean
          description: Whether public snippet sharing is enabled
        s3_sync:
          type: boolean
          description: Whether S3 sync is enabled
        api_tokens:
          type: boolean
          description: Whether API token creation is enabled
        backup_restore:
          type: boolean
          description: Whether backup/restore is enabled

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          examples:
            - healthy
        version:
          type: string
          examples:
            - 1.0.0
        commit:
          type: string
          examples:
            - abc1234
        uptime:
          type: string
          examples:
            - "24h30m15s"
        checks:
          type: object
          properties:
            database:
              type: string
              examples:
                - healthy
        memory:
          type: object
          properties:
            alloc_mb:
              type: integer
            total_alloc_mb:
              type: integer
            sys_mb:
              type: integer
            num_gc:
              type: integer
        features:
          $ref: '#/components/schemas/FeatureFlags'
        timestamp:
          type: string
          format: date-time

    LoginRequest:
      type: object
      required: [password]
      properties:
        password:
          type: string

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string

    ChangePasswordRequest:
      type: object
      required: [current_password, new_password]
      properties:
        current_password:
          type: string
        new_password:
          type: string
          minLength: 6

    Snippet:
      type: object
      properties:
        id:
          type: string
          examples:
            - a1b2c3d4e5f6
        title:
          type: string
          examples:
            - Docker Compose Template
        description:
          type: string
          examples:
            - Basic multi-container setup
        content:
          type: string
          description: Primary file content (legacy)
        language:
          type: string
          examples:
            - yaml
        is_favorite:
          type: boolean
        is_public:
          type: boolean
        view_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        tags:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        folders:
          type: array
          items:
            $ref: '#/components/schemas/Folder'
        files:
          type: array
          items:
            $ref: '#/components/schemas/SnippetFile'

    SnippetFile:
      type: object
      properties:
        id:
          type: integer
        filename:
          type: string
          examples:
            - main.js
        content:
          type: string
        language:
          type: string
          examples:
            - javascript
        sort_order:
          type: integer

    SnippetInput:
      type: object
      required: [title]
      properties:
        title:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 1000
        content:
          type: string
          description: Legacy single-file content
        language:
          type: string
          default: plaintext
        tags:
          type: array
          items:
            type: string
          description: Tag names (auto-created if not exist)
        folder_id:
          type: [integer, "null"]
        is_public:
          type: boolean
          default: false
        files:
          type: array
          items:
            $ref: '#/components/schemas/SnippetFileInput'
          description: Multi-file content

    SnippetFileInput:
      type: object
      required: [filename]
      properties:
        id:
          type: integer
          description: File ID (0 for new files)
        filename:
          type: string
        content:
          type: string
        language:
          type: string

    SnippetListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Snippet'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Tag:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          examples:
            - docker
        color:
          type: string
          examples:
            - "#0db7ed"
        created_at:
          type: string
          format: date-time
        snippet_count:
          type: integer

    TagInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 50
        color:
          type: string
          default: "#6366f1"
          pattern: "^#[0-9a-fA-F]{6}$"

    Folder:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          examples:
            - DevOps
        parent_id:
          type: [integer, "null"]
        icon:
          type: string
          default: folder
        sort_order:
          type: integer
        created_at:
          type: string
          format: date-time
        snippet_count:
          type: integer
        children:
          type: array
          items:
            $ref: '#/components/schemas/Folder'
          description: Only present when tree=true

    FolderInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 100
        parent_id:
          type: [integer, "null"]
        icon:
          type: string
        sort_order:
          type: integer

    APIToken:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          examples:
            - CI/CD Token
        token:
          type: string
          description: Only returned on creation
        permissions:
          type: string
          enum: [read, write, admin]
        last_used_at:
          type: [string, "null"]
          format: date-time
        expires_at:
          type: [string, "null"]
          format: date-time
        created_at:
          type: string
          format: date-time

    APITokenInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 100
        permissions:
          type: string
          enum: [read, write, admin]
          default: read
        expires_at:
          type: [string, "null"]
          format: date-time

    BackupData:
      type: object
      properties:
        version:
          type: string
        created_at:
          type: string
          format: date-time
        snippets:
          type: array
          items:
            $ref: '#/components/schemas/Snippet'
        tags:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        folders:
          type: array
          items:
            $ref: '#/components/schemas/Folder'

    ExportOptions:
      type: object
      properties:
        format:
          type: string
          enum: [json, zip]
          default: json
        password:
          type: string
          description: Optional encryption password

    ImportResult:
      type: object
      properties:
        snippets_imported:
          type: integer
        tags_imported:
          type: integer
        folders_imported:
          type: integer
        errors:
          type: array
          items:
            type: string

    S3BackupInfo:
      type: object
      properties:
        key:
          type: string
          examples:
            - backups/snipo-backup-2024-12-01.json
        size:
          type: integer
        last_modified:
          type: string
          format: date-time

    S3SyncResult:
      type: object
      properties:
        uploaded:
          type: integer
        errors:
          type: array
          items:
            type: string
        started_at:
          type: string
          format: date-time
        finished_at:
          type: string
          format: date-time

    # Settings Schemas
    Settings:
      type: object
      properties:
        theme:
          type: string
          enum: [light, dark]
          examples:
            - dark
        editor_theme:
          type: string
          description: Ace editor theme (40+ supported themes)
          examples:
            - tomorrow_night
        font_size:
          type: integer
          minimum: 8
          maximum: 32
          description: Editor font size in pixels (0 = default)
          examples:
            - 14
        tab_size:
          type: integer
          minimum: 1
          maximum: 8
          description: Tab size in spaces (0 = default)
          examples:
            - 4
        markdown_font_size:
          type: integer
          minimum: 8
          maximum: 32
          description: Markdown preview font size (0 = default)
          examples:
            - 16
        archive_enabled:
          type: boolean
          description: Whether archive feature is enabled
        history_enabled:
          type: boolean
          description: Whether history tracking is enabled

    SettingsInput:
      type: object
      description: Settings update input with validation constraints
      properties:
        theme:
          type: string
          enum: [light, dark]
          description: UI theme
        editor_theme:
          type: string
          description: |
            Ace editor theme. Supported values include:
            ambiance, chaos, chrome, clouds, clouds_midnight, cobalt, crimson_editor,
            dawn, dracula, dreamweaver, eclipse, github, gob, gruvbox, idle_fingers,
            iplastic, katzenmilch, kr_theme, kuroir, merbivore, merbivore_soft,
            mono_industrial, monokai, nord_dark, pastel_on_dark, solarized_dark,
            solarized_light, sqlserver, terminal, textmate, tomorrow, tomorrow_night,
            tomorrow_night_blue, tomorrow_night_bright, tomorrow_night_eighties,
            twilight, vibrant_ink, xcode, and more.
        font_size:
          type: integer
          minimum: 8
          maximum: 32
          description: Editor font size (0 = use default)
        tab_size:
          type: integer
          minimum: 1
          maximum: 8
          description: Tab size (0 = use default)
        markdown_font_size:
          type: integer
          minimum: 8
          maximum: 32
          description: Markdown font size (0 = use default)
        archive_enabled:
          type: boolean
        history_enabled:
          type: boolean

    # History Schema
    HistoryEntry:
      type: object
      description: Snippet version history entry
      properties:
        id:
          type: string
          description: History entry ID
        snippet_id:
          type: string
          description: Associated snippet ID
        title:
          type: string
          description: Snippet title at this version
        content:
          type: string
          description: Snippet content at this version
        language:
          type: string
          description: Language at this version
        description:
          type: string
          description: Description at this version
        created_at:
          type: string
          format: date-time
          description: When this version was created

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Forbidden:
      description: Forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'

    TooManyRequests:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
